<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MC ä¼ºæœå™¨ç‹€æ…‹ç®¡ç†é é¢</title>
    <style>
        /* CSS æ¨£å¼èˆ‡æ‚¨æä¾›çš„å®Œå…¨ç›¸åŒ */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f4; color: #333; text-align: center; padding-top: 50px; }
        .container { max-width: 600px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        h1 { color: #007bff; margin-bottom: 20px; }
        .status-display { padding: 20px; border-radius: 8px; font-size: 1.8em; font-weight: bold; margin-bottom: 30px; }
        .online { background-color: #d4edda; color: #155724; }
        .maintenance { background-color: #fff3cd; color: #856404; }
        .offline { background-color: #f8d7da; color: #721c24; }
        .address { font-size: 1.2em; margin-bottom: 20px; }
        .admin-button { padding: 10px 20px; font-size: 1em; cursor: pointer; background-color: #6c757d; color: white; border: none; border-radius: 5px; }
        #admin-panel { margin-top: 30px; padding: 20px; border: 1px solid #ccc; border-radius: 5px; display: none; text-align: left; }
        #admin-panel label { display: block; margin-top: 10px; font-weight: bold; }
        #admin-panel select, #admin-panel input[type="text"] { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        #admin-panel button { margin-top: 15px; background-color: #28a745; }
    </style>
</head>
<body>

    <div class="container">
        <h1>â›ï¸ MC ä¼ºæœå™¨ç‹€æ…‹ â›ï¸</h1>
        
        <div class="address">
            ä¼ºæœå™¨åœ°å€ï¼š<strong>mc.mqi.qzz.io:19132</strong>
        </div>

        <div id="status-display-area" class="status-display maintenance">
            è¼‰å…¥ä¸­...
        </div>

        <button class="admin-button" onclick="promptAdminLogin()">ç®¡ç†å“¡ç™»å…¥</button>
        
        <div id="admin-panel">
            <h2>æ›´æ–°ä¼ºæœå™¨ç‹€æ…‹</h2>
            <label for="new-status">é¸æ“‡æ–°ç‹€æ…‹ï¼š</label>
            <select id="new-status">
                <option value="online">ğŸŸ¢ ä¼ºæœå™¨åœ¨ç·š</option>
                <option value="maintenance">ğŸŸ¡ ç¶­è­·ä¸­</option>
                <option value="offline">ğŸ”´ ä¼ºæœå™¨é›¢ç·š</option>
            </select>
            
            <label for="new-message">ç‹€æ…‹è¨Šæ¯ (é¸å¡«ï¼Œä¾‹å¦‚ï¼šé è¨ˆ 18:00 é–‹æ©Ÿ):</label>
            <input type="text" id="new-message" placeholder="è¼¸å…¥è¨Šæ¯...">

            <button class="admin-button" onclick="saveStatus()" style="background-color: #007bff;">å„²å­˜ä¸¦æ›´æ–°ç‹€æ…‹</button>
        </div>
    </div>

    <script>
        const STATUS_API_ENDPOINT = '/api/status';
        
        // --- è¼‰å…¥å’Œé¡¯ç¤ºç‹€æ…‹ (å¾ KV è®€å–) ---
        async function loadStatus() {
            const displayArea = document.getElementById('status-display-area');
            displayArea.className = 'status-display maintenance';
            displayArea.innerHTML = 'æ­£åœ¨å¾ä¼ºæœå™¨è¼‰å…¥...';
            
            try {
                const response = await fetch(STATUS_API_ENDPOINT); 
                const statusData = await response.json(); 

                const { status, message } = statusData;

                displayArea.className = 'status-display'; 
                displayArea.classList.add(status);
                
                let statusText = '';
                if (status === 'online') {
                    statusText = 'ğŸŸ¢ ä¼ºæœå™¨åœ¨ç·š';
                } else if (status === 'maintenance') {
                    statusText = 'ğŸŸ¡ ç¶­è­·ä¸­';
                } else if (status === 'offline') {
                    statusText = 'ğŸ”´ ä¼ºæœå™¨é›¢ç·š';
                }

                const finalMessage = message || 'ç„¡æœ€æ–°è¨Šæ¯ã€‚';

                displayArea.innerHTML = `${statusText} <br><small style="font-size: 0.5em; font-weight: normal;">${finalMessage}</small>`;

                document.getElementById('new-status').value = status;
                document.getElementById('new-message').value = message;

            } catch (error) {
                console.error('Failed to load status:', error);
                displayArea.className = 'status-display offline';
                displayArea.innerHTML = 'ğŸ”´ éŒ¯èª¤ <br><small style="font-size: 0.5em; font-weight: normal;">ç„¡æ³•é€£ç·šåˆ°ç‹€æ…‹ APIï¼Œè«‹æª¢æŸ¥éƒ¨ç½²ã€‚</small>';
            }
        }

        // --- ç®¡ç†å“¡æ“ä½œ (Zero Trust) ---
        function promptAdminLogin() {
            document.getElementById('admin-panel').style.display = 'block';
            alert("å·²é€²å…¥ç®¡ç†æ¨¡å¼ã€‚è«‹æ³¨æ„ï¼šç‹€æ…‹æ›´æ–°çš„æ¬Šé™å°‡ç”± Zero Trust é©—è­‰ã€‚");
        }

        async function saveStatus() {
            const newStatus = document.getElementById('new-status').value;
            const rawMessage = document.getElementById('new-message').value.trim();
            
            let finalMessage;
             if (!rawMessage) {
                if (newStatus === 'online') {
                    finalMessage = 'æ­¡è¿é€£ç·šï¼ä¼ºæœå™¨é‹è¡Œç©©å®šã€‚';
                } else if (newStatus === 'offline') {
                    finalMessage = 'ä¼ºæœå™¨ç›®å‰å·²é—œæ©Ÿæˆ–ç„¡æ³•é€£ç·šã€‚';
                } else if (newStatus === 'maintenance') {
                    finalMessage = 'ä¼ºæœå™¨æ­£åœ¨é€²è¡Œè‡¨æ™‚ç¶­è­·ï¼Œå¾ˆå¿«æœƒå›ä¾†ã€‚';
                } else {
                    finalMessage = 'ç‹€æ…‹å·²æ›´æ–°ï¼Œä½†ç„¡å…·é«”è¨Šæ¯ã€‚';
                }
            } else {
                finalMessage = rawMessage;
            }


            const updatedData = {
                status: newStatus,
                message: finalMessage
            };

            try {
                const response = await fetch(STATUS_API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedData)
                });

                if (response.ok) {
                    alert("âœ… ç‹€æ…‹å·²æˆåŠŸæ›´æ–°è‡³ä¼ºæœå™¨ï¼");
                    loadStatus();
                    document.getElementById('admin-panel').style.display = 'none';
                } else if (response.status === 401 || response.status === 403) {
                    alert("âŒ æ¬Šé™éŒ¯èª¤ï¼šæ‚¨æ²’æœ‰æ¬Šé™æ›´æ–°ç‹€æ…‹ã€‚è«‹é€šé Zero Trust ç™»å…¥æ‚¨çš„ç®¡ç†å“¡ Emailã€‚");
                } else {
                    alert(`âŒ æ›´æ–°å¤±æ•— (${response.status})ã€‚è«‹æª¢æŸ¥ Pages Function æ—¥èªŒã€‚`);
                }

            } catch (error) {
                console.error('Update failed:', error);
                alert("âŒ ç¶²è·¯éŒ¯èª¤ï¼šç„¡æ³•é€£ç·šåˆ°ç‹€æ…‹ APIã€‚");
            }
        }

        window.onload = loadStatus;
    </script>

</body>
</html>
