<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å“¡ä¸­å¿ƒ - ç‹€æ…‹æ›´æ–°</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"> 
    <style>
        /* ç¹¼æ‰¿ index.html çš„ä¸»è¦æ¨£å¼ï¼Œåªæ–°å¢ç®¡ç†é¢æ¿ */
        :root { /* ... ä¿æŒä¸è®Š ... */
            --color-green: #28a745;
            --color-red: #dc3545;
            --color-blue: #007bff;
            --color-black: #343a40;
            --color-gray-light: #f8f9fa;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f4; color: var(--color-black); padding: 20px; text-align: center; }
        .container { max-width: 600px; margin: 50px auto; background: #ffffff; padding: 30px; border-radius: 12px; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); text-align: left; }
        h2 { color: var(--color-blue); margin-bottom: 25px; text-align: center; }
        .admin-panel { padding: 25px; border: 1px solid #ccc; border-radius: 8px; background-color: var(--color-gray-light); }
        .admin-button { padding: 10px 25px; font-size: 1em; cursor: pointer; background-color: var(--color-blue); color: white; border: none; border-radius: 5px; transition: background-color 0.3s; margin-top: 20px; width: 100%; }
        .admin-button:hover { background-color: #0056b3; }
        label { display: block; margin-top: 15px; font-weight: bold; color: var(--color-black); }
        select, input[type="text"] { width: 100%; padding: 10px; margin-top: 8px; border: 1px solid #ced4da; border-radius: 4px; box-sizing: border-box; }
        #status-display { text-align: center; font-weight: bold; margin-bottom: 15px; color: var(--color-red); }
        .status-info { text-align: center; font-size: 0.9em; color: #666; margin-top: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <h2><i class="fas fa-lock"></i> ä¼ºæœå™¨ç‹€æ…‹ç®¡ç†</h2>

        <div id="status-display">æ­£åœ¨è¼‰å…¥ç•¶å‰ç‹€æ…‹...</div>

        <div class="admin-panel">
            <p class="status-info">æ‚¨å·²æˆåŠŸé€šé Zero Trust é©—è­‰ã€‚è«‹æ›´æ–°ç‹€æ…‹ï¼š</p>
            <label for="new-status">é¸æ“‡æ–°ç‹€æ…‹ï¼š</label>
            <select id="new-status">
                <option value="online_normal">ğŸŸ¢ æ­£å¸¸é‹è¡Œ (Stable)</option>
                <option value="online_lagging">ğŸŸ  é‹è¡Œç·©æ…¢ (Lagging)</option>
                <option value="maintenance_planned">ğŸŸ¡ æ’ç¨‹ç¶­è­·ä¸­</option>
                <option value="maintenance_urgent">ğŸ”´ ç·Šæ€¥ä¿®å¾©ä¸­</option>
                <option value="offline_graceful">ğŸ”µ æ­£å¸¸é—œé–‰ (Sleep)</option>
                <option value="offline_crashed">âš« æ„å¤–å´©æ½° (Crashed)</option>
                <option value="startup_check">ğŸŸ£ å•Ÿå‹•ä¸­ (Checking)</option>
                <option value="startup_complete">ğŸŸ£ æº–å‚™å®Œç•¢ (Ready)</option>
            </select>
            
            <label for="new-message">ç‹€æ…‹è¨Šæ¯ (é¸å¡«ï¼Œå°ç©å®¶é¡¯ç¤ºçš„è©³ç´°è³‡è¨Š):</label>
            <input type="text" id="new-message" placeholder="è¼¸å…¥è¨Šæ¯...">

            <button class="admin-button" onclick="saveStatus()">å„²å­˜ä¸¦æ›´æ–°ç‹€æ…‹</button>
        </div>
        <div class="status-info">æ›´æ–°å¾Œè«‹é»æ“Š <a href="index.html">è¿”å›å‰å°</a> ç¢ºèªç‹€æ…‹ã€‚</div>
    </div>

    <script>
        // è®€å–è·¯å¾‘å’Œæ›´æ–°è·¯å¾‘å¿…é ˆåˆ†é–‹
        const STATUS_READ_ENDPOINT = '/status-public'; // å…¬é–‹è·¯å¾‘
        const STATUS_UPDATE_ENDPOINT = '/api/status'; // å—ä¿è­·è·¯å¾‘ (POST)
        
        // --- ç‹€æ…‹è½‰æ›èˆ‡åœ–æ¨™ ---
        function getStatusInfo(status) {
            // ... (åŒ index.html çš„é‚è¼¯) ...
            switch(status) {
                case 'online_normal': return { text: 'ğŸŸ¢ æ­£å¸¸é‹è¡Œ (Stable)', icon: 'fas fa-check-circle', defaultMsg: 'ä¼ºæœå™¨é‹è¡Œç©©å®šï¼Œæ­¡è¿é€£ç·šï¼' };
                case 'online_lagging': return { text: 'ğŸŸ  é‹è¡Œç·©æ…¢ (Lagging)', icon: 'fas fa-exclamation-triangle', defaultMsg: 'ä¼ºæœå™¨é‹è¡Œç·©æ…¢ï¼Œè«‹ç­‰å¾…ç®¡ç†å“¡è™•ç†ã€‚' };
                case 'maintenance_planned': return { text: 'ğŸŸ¡ æ’ç¨‹ç¶­è­·ä¸­', icon: 'fas fa-calendar-alt', defaultMsg: 'æ­£åœ¨é€²è¡Œæ’ç¨‹ç¶­è­·ï¼Œé è¨ˆçµæŸæ™‚é–“è«‹åƒè€ƒä¸‹æ–¹è¨Šæ¯ã€‚' };
                case 'maintenance_urgent': return { text: 'ğŸ”´ ç·Šæ€¥ä¿®å¾©ä¸­', icon: 'fas fa-shield-alt', defaultMsg: 'ç·Šæ€¥ä¿®å¾©ä¸­ï¼Œå°‡åœ¨çŸ­æ™‚é–“å…§é‡å•Ÿã€‚' };
                case 'offline_graceful': return { text: 'ğŸ”µ æ­£å¸¸é—œé–‰ (Sleep)', icon: 'fas fa-power-off', defaultMsg: 'ä¼ºæœå™¨å·²ç”±ç®¡ç†å“¡æ­£å¸¸é—œæ©Ÿã€‚' };
                case 'offline_crashed': return { text: 'âš« æ„å¤–å´©æ½° (Crashed)', icon: 'fas fa-bug', defaultMsg: 'ä¼ºæœå™¨æ„å¤–å´©æ½°ï¼Œæ­£åœ¨æª¢æŸ¥ä¸­ã€‚' };
                case 'startup_check': return { text: 'ğŸŸ£ å•Ÿå‹•ä¸­ (Checking)', icon: 'fas fa-cogs', defaultMsg: 'ä¼ºæœå™¨é€²ç¨‹å·²å•Ÿå‹•ï¼Œæ­£åœ¨è¼‰å…¥ä¸–ç•Œæ•¸æ“šã€‚' };
                case 'startup_complete': return { text: 'ğŸŸ£ æº–å‚™å®Œç•¢ (Ready)', icon: 'fas fa-hourglass-end', defaultMsg: 'ä¼ºæœå™¨å•Ÿå‹•å®Œæˆï¼Œç®¡ç†å“¡æº–å‚™é–‹æ”¾ä¸­ã€‚' };
                default: return { text: 'â“ ç‹€æ…‹æœªçŸ¥', defaultMsg: 'Pages Function ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤æˆ– KV è³‡æ–™ç•°å¸¸ã€‚' };
            }
        }

        // è¼‰å…¥ç•¶å‰ç‹€æ…‹åˆ°ç®¡ç†è¡¨å–®
        async function loadCurrentStatus() {
            const statusDisplay = document.getElementById('status-display');
            try {
                // è®€å–è«‹æ±‚ï¼šä½¿ç”¨å…¬é–‹è·¯å¾‘
                const response = await fetch(STATUS_READ_ENDPOINT); 
                const statusData = await response.json(); 
                const { status, message } = statusData;
                const info = getStatusInfo(status);

                statusDisplay.innerHTML = `ç•¶å‰ç‹€æ…‹: <strong>${info.text}</strong>`;
                document.getElementById('new-status').value = status;
                document.getElementById('new-message').value = message;
            } catch (error) {
                statusDisplay.textContent = 'ç„¡æ³•è®€å–ç•¶å‰ç‹€æ…‹ï¼Œè«‹æ‰‹å‹•é¸æ“‡ã€‚';
            }
        }

        // å„²å­˜ç‹€æ…‹ (POST è«‹æ±‚)
        async function saveStatus() {
            const newStatus = document.getElementById('new-status').value;
            const rawMessage = document.getElementById('new-message').value.trim();
            
            const info = getStatusInfo(newStatus);
            let finalMessage = rawMessage || info.defaultMsg;

            const updatedData = { status: newStatus, message: finalMessage };

            try {
                // POST è«‹æ±‚ï¼šç™¼é€åˆ°å—ä¿è­·è·¯å¾‘
                const response = await fetch(STATUS_UPDATE_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedData)
                });

                if (response.ok) {
                    alert("âœ… ç‹€æ…‹å·²æˆåŠŸæ›´æ–°è‡³ä¼ºæœå™¨ï¼");
                    loadCurrentStatus(); // æ›´æ–°å¾Œé‡æ–°è¼‰å…¥é¡¯ç¤º
                } else if (response.status === 401 || response.status === 403) {
                    alert("âŒ æ¬Šé™éŒ¯èª¤ï¼šæ‚¨æ²’æœ‰æ¬Šé™æ›´æ–°ç‹€æ…‹ã€‚è«‹ç¢ºèªå·²é€šé Zero Trust é©—è­‰ã€‚");
                } else {
                    alert(`âŒ æ›´æ–°å¤±æ•— (${response.status})ã€‚è«‹æª¢æŸ¥ Pages Function æ—¥èªŒã€‚`);
                }

            } catch (error) {
                alert("âŒ ç¶²è·¯éŒ¯èª¤ï¼šç„¡æ³•é€£ç·šåˆ°ç‹€æ…‹ APIã€‚");
            }
        }

        window.onload = loadCurrentStatus;
    </script>

</body>
</html>
